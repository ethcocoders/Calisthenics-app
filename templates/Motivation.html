<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motivation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Motivation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>
<body>
    <div class="container">
        {% include '_sidebar.html' %}

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h1>Motivation</h1>
                <div class="header-actions">
                    <button id="addMotivationBtn"><i class="fas fa-plus"></i> Add Motivation</button>
                </div>
            </div>

            <!-- Category Navigation -->
            <div class="categories-nav">
                <a href="{{ url_for('motivation', category='all') }}" class="category-btn {{ 'active' if active_category == 'all' else '' }}">
                    <i class="fas fa-fire"></i> All
                </a>
                {% for cat in categories %}
                <a href="{{ url_for('motivation', category=cat) }}" class="category-btn {{ 'active' if active_category == cat else '' }}">
                    {% if cat == 'video' %}<i class="fas fa-video"></i>
                    {% elif cat == 'book' %}<i class="fas fa-book"></i>
                    {% elif cat == 'quote' %}<i class="fas fa-quote-right"></i>
                    {% elif cat == 'movie' %}<i class="fas fa-film"></i>
                    {% elif cat == 'podcast' %}<i class="fas fa-podcast"></i>
                    {% elif cat == 'image' %}<i class="fas fa-image"></i>
                    {% endif %}
                    {{ cat.title() }}
                </a>
                {% endfor %}
            </div>

            <!-- Motivational Content Grid -->
            <div class="motivation-grid">
                {% for item in motivation_items %}
                <div class="motivation-card">
                    <a href="{{ item.source_url or '#' }}" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit; display: contents;">
                        <div class="card-image {{ item.category }}" style="{% if item.cover_image_path %}background-image: url('{{ url_for('static', filename=item.cover_image_path) }}');{% endif %}">
                            <span>{{ item.title if item.category == 'quote' else '' }}</span>
                        </div>
                        <div class="card-content">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">{{ item.title }}</div>
                                    <div class="card-category">{{ item.category.title() }}</div>
                                </div>
                            </div>
                            <div class="card-description">
                                {{ item.description or 'No description provided.' }}
                            </div>
                            <div class="card-meta">
                                <span><i class="fas fa-user"></i> {{ item.author or 'Unknown' }}</span>
                                {% if item.source_url %}
                                <span class="card-link"><i class="fas fa-link"></i> View Source</span>
                                {% endif %}
                            </div>
                        </div>
                    </a>
                    <div class="card-actions">
                        <form action="{{ url_for('toggle_motivation_favorite', item_id=item.id) }}" method="POST">
                            <button type="submit" class="card-action-btn favorite {{ 'is-favorite' if item.is_favorite else 'not-favorite' }}" title="{{ 'Remove from favorites' if item.is_favorite else 'Add to favorites' }}">
                                <i class="fas fa-star"></i>
                            </button>
                        </form>
                        <form action="{{ url_for('delete_motivation_item', item_id=item.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this item?');">
                            <button type="submit" class="card-action-btn delete" title="Delete item">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </div>
                {% else %}
                <p style="text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">No motivational content found. Try a different category or add some!</p>
                {% endfor %}
            </div>
        </div>

        <!-- Add Motivation Modal -->
        <div class="add-motivation-modal" id="addMotivationModal">
            <div class="modal-content">
                <form action="{{ url_for('add_motivation_item') }}" method="POST" enctype="multipart/form-data">
                    <div class="modal-header">
                        <h3 class="modal-title">Add New Motivation</h3>
                        <button type="button" class="close-modal" id="closeModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivationType">Content Type</label>
                        <select id="motivationType" name="category" required>
                            <option value="" disabled selected>Select content type</option>
                            <option value="video">Video</option>
                            <option value="book">Book</option>
                            <option value="quote">Quote</option>
                            <option value="movie">Movie/Clip</option>
                            <option value="podcast">Podcast</option>
                            <option value="image">Image</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivationTitle">Title</label>
                        <input type="text" id="motivationTitle" name="title" placeholder="e.g., Atomic Habits, Rocky Training Montage" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivationDescription">Description</label>
                        <textarea id="motivationDescription" name="description" placeholder="A short summary or a powerful quote"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivationAuthor">Author/Creator (Optional)</label>
                        <input type="text" id="motivationAuthor" name="author" placeholder="e.g., James Clear, Sylvester Stallone">
                    </div>
                    
                    <div class="form-group">
                        <label>Upload Cover Image (Optional)</label>
                        <div class="file-upload" id="fileUploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Click to upload an image</p>
                            <p><small>Recommended for a better look</small></p>
                            <input type="file" id="mediaFiles" name="cover_image" accept="image/*">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="motivationURL">URL/Link (Optional)</label>
                        <input type="url" id="motivationURL" name="source_url" placeholder="https://youtube.com/watch?v=...">
                    </div>
                    
                    <div class="form-buttons">
                        <button type="button" class="modal-btn cancel" id="cancelMotivationBtn">Cancel</button>
                        <button type="submit" class="modal-btn save">Add Motivation</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const addMotivationBtn = document.getElementById('addMotivationBtn');
                const addMotivationModal = document.getElementById('addMotivationModal');
                const closeModalBtn = document.getElementById('closeModal');
                const cancelMotivationBtn = document.getElementById('cancelMotivationBtn');
                const fileUploadArea = document.getElementById('fileUploadArea');
                const mediaFilesInput = document.getElementById('mediaFiles');

                // Open modal
                if (addMotivationBtn) {
                    addMotivationBtn.addEventListener('click', () => addMotivationModal.style.display = 'flex');
                }

                // Close modal functions
                function closeModal() {
                    addMotivationModal.style.display = 'none';
                    const form = addMotivationModal.querySelector('form');
                    form.reset();
                    // Reset file upload UI
                    fileUploadArea.innerHTML = `
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Click to upload an image</p>
                        <p><small>Recommended for a better look</small></p>
                        <input type="file" id="mediaFiles" name="cover_image" accept="image/*">`;
                    // Re-bind listener after innerHTML reset
                    document.getElementById('mediaFiles').addEventListener('change', handleFileSelect);
                }

                if(closeModalBtn) closeModalBtn.addEventListener('click', closeModal);
                if(cancelMotivationBtn) cancelMotivationBtn.addEventListener('click', closeModal);
                if(addMotivationModal) addMotivationModal.addEventListener('click', (e) => {
                    if (e.target === addMotivationModal) closeModal();
                });

                // File upload UI functionality
                function handleFileSelect() {
                    if (this.files && this.files.length > 0) {
                        const fileName = this.files[0].name;
                        fileUploadArea.innerHTML = `
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            <p>File selected: ${fileName}</p>
                            <p><small>Click to change</small></p>
                            <input type="file" id="mediaFiles" name="cover_image" accept="image/*" style="display: none;">
                        `;
                    }
                }
                
                if(fileUploadArea) fileUploadArea.addEventListener('click', () => document.getElementById('mediaFiles').click());
                if(mediaFilesInput) mediaFilesInput.addEventListener('change', handleFileSelect);

                // Note: Filtering, deleting, and favoriting are now handled by the backend
                // through standard links and form submissions. No complex JS is needed for those actions.
            });
        </script>
</body>
</html>