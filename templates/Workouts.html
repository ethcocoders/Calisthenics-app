<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workouts</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/workout.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/responsive.css') }}">
</head>
<body>
    <div class="container">
        {% include '_sidebar.html' %}

        <div class="main-content">
            <div class="header">
                <h1>Workouts</h1>
                <div class="header-actions">
                    <button id="openModalBtn"><i class="fas fa-plus"></i> Add Exercise</button>
                </div>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="workouts-grid">
                {% for workout in workouts %}
                <div class="exercise-card">
                    <div class="card-header">
                        <div class="exercise-name">{{ workout.name }}</div>
                        <div class="exercise-difficulty difficulty-{{ workout.difficulty.lower() }}">{{ workout.difficulty }}</div>
                    </div>
                    <div class="exercise-stats">
                        <div class="stat-item"><div class="stat-value">{{ workout.sets }}</div><div class="stat-label">Sets</div></div>
                        <div class="stat-item"><div class="stat-value">{{ workout.reps }}</div><div class="stat-label">Reps</div></div>
                        <div class="stat-item"><div class="stat-value">{{ workout.rest }}</div><div class="stat-label">Rest</div></div>
                    </div>
                    
                    <div class="expanded-content">
                        <div class="exercise-details">
                            <h4>Proper Form Instructions</h4>
                            <ul class="exercise-steps">
                                {% for line in workout.instructions.strip().split('\n') %}
                                <li>{{ line.strip().lstrip('- ') }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        <div class="card-actions">
                            <button class="action-btn edit"><i class="fas fa-edit"></i> Edit</button>
                            <!-- DELETE FORM -->
                            <form action="{{ url_for('delete_workout', workout_id=workout.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this workout?');">
                                <button type="submit" class="action-btn delete"><i class="fas fa-trash"></i> Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Add Exercise Modal -->
    <div id="addWorkoutModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Add New Exercise</h2>
            <form action="{{ url_for('add_workout') }}" method="POST" class="modal-form">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="name">Exercise Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="sets">Sets</label>
                        <input type="number" id="sets" name="sets" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="reps">Reps</label>
                        <input type="text" id="reps" name="reps" placeholder="e.g., 12 or 10/Leg" required>
                    </div>
                    <div class="form-group">
                        <label for="rest">Rest</label>
                        <input type="text" id="rest" name="rest" placeholder="e.g., 2m or 90s" required>
                    </div>
                    <div class="form-group">
                        <label for="difficulty">Difficulty</label>
                        <select id="difficulty" name="difficulty" required>
                            <option value="Beginner">Beginner</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Advanced">Advanced</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="instructions">Instructions (one step per line)</label>
                        <textarea id="instructions" name="instructions" rows="4" required></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="header-actions-button" style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600;">Save Exercise</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Card Expansion Logic ---
        document.querySelectorAll('.exercise-card').forEach(card => {
            card.addEventListener('click', function(e) {
                if (e.target.closest('.action-btn, form')) { return; }
                const isExpanded = this.classList.contains('expanded');
                document.querySelectorAll('.exercise-card').forEach(c => c.classList.remove('expanded'));
                if (!isExpanded) this.classList.add('expanded');
            });
        });
        document.addEventListener('click', e => {
            if (!e.target.closest('.exercise-card')) {
                document.querySelectorAll('.exercise-card').forEach(c => c.classList.remove('expanded'));
            }
        });

        // --- Modal Logic ---
        const modal = document.getElementById('addWorkoutModal');
        const openBtn = document.getElementById('openModalBtn');
        const closeBtn = document.querySelector('.close-button');

        openBtn.onclick = () => { modal.style.display = 'block'; }
        closeBtn.onclick = () => { modal.style.display = 'none'; }
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
